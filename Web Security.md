# Seguridad web

## Ideas principales

- Todo lo que tenga como origen el usuario ha de considerarse no confiable y malicioso
- Los controles de seguridad han de implementarse en el servidor, no unicamente en el cliente
- La aplicacion ha de estar preparada para cualquier comportamiento no esperado
- La aplicacion ha de estar preparada para un alto numero de peticiones
- Si no entiendes que hace la web, no sabrás revisarla

## Fase 0: Datos iniciales

- [ ] Nombre: 
- [ ] Dominio:
- [ ] URL:
- [ ] Ip:
- [ ] User1:
- [ ] User2:
- [ ] Fechas:
- [ ] Extra:

## Fase 1: Information Gathering

### Objetivo

1. Conocer la aplicación - Mapear la aplicación
2. Obtención de informacion - Información publica
3. Identificar funcionalilades
4. Identificar puntos de entrada de datos
5. Identificar tecnologias

### Vulnerabilidades

- [ ] Fingerprint de la aplicacion (versiones, cms, frameworks, lenguajes)
- [ ] Información contenida en el robots
- [ ] Enumeración de aplicaciones alojadas en el servidor
- [ ] Comentarios encontrados en el codigo
- [ ] Gestion de errores
- [ ] Enumeracion de directorios
- [ ] Directory Listing
- [ ] Metadatos en los documentos
- [ ] Informacion en fuentes publicas
- [ ] Informacion extraida del envio de un correo falso
- [ ] Identificacion de WSLD
- [ ] Vulnerabilidades publicas
- [ ] Debilidades criptograficas
- [ ] Puertos abiertos

### How to
1. Utilizar fuentes de información publica para obtener información sobre la aplicación

   - google

   - shodan

   - netcraft
2. Consultar robots
3. Explorar el contenido publico y privado de la aplicacion(spider)
4. Descubrir contenido por defecto
5. Descubirir contenido oculto
6. Identificar funciones especificas
7. Identificar los parametros
8. Identificar links (http)
9. Identificar errores no controlados
10. Identificar comentarios
11. Analizar cabeceras e identificar tecnologias
12. Metadatos
13. Test SSL
14. Test nmap
15. Test Virtual host
16. Test nikto
17. Test theharvester
18. Test Dirb 

## Fase 2: Configuración

### Vulnerabilidades

- [ ] Uso de protocolo HTTP
- [ ] Detección de paneles de administración
- [ ] Revision de metodos HTTP (Options, trace)
- [ ] Intercambio de metodos HTTP (GET/POST)
- [ ] Tipos de cabeceras (clickjacking, http stric, no xss)
- [ ] Política de navegador

## Fase 3: Controles en cliente

### Objetivo

1- Revision de los controles de cliente
2- Detectar cómo es posible evadirlas

### How to

1. Revisar campos ocultos
2. Revisar cookies
3. Revisar parametros
4. Revisar ASP.Net view state
5. Revisar los controles limites de tamaño de los parametros en cliente
6. Revisar validaciones por parte del cliente
7. Revisar elementos desactivdados
8. Revisar extensiones de navegador

## Fase 4: Autenticación

### Vulnerabilidades

- [ ] Politica de usuarios
- [ ] Politica de password
- [ ] Credenciales por defecto
- [ ] Enumeración de usuarios (por diferencias de tiempo o de respuestas)
- [ ] Politica de lockout/Bloqueo de cuentas (realizar el ultimo)
- [ ] Transmision de credenciales por URL con metodo GET
- [ ] Transmision de credenciales por HTTP
- [ ] Comunicación de credenciales al usuario de forma insegura
- [ ] Funcionalidad de cambio de password en entorno no autenticado
- [ ] Los Password iniciales no son de un solo uso y no se obliga a cambiarlos
- [ ] Se facilita Información excesiva en el caso de fallo de login
- [ ] La recuperación de password no se realiza mediante email y una URL OTP
- [ ] Las Credenciales almacenadas en cookies
- [ ] Credenciales almacenadas en claro
- [ ] Comunicación de las credenciales en claro por correo
- [ ] Credenciales comunicadas en cada petición, no utiliza contexto de sesión
- [ ] Tipo de cache de las paginas
- [ ] Bypass del login
- [ ] Errores en funcionalidades de autenticacion
- [ ] Acceso a recursos autenticados sin estarlo
- [ ] Uso de Basic autentication en lugar de Digest
- [ ] Uso de funcionalidades en entorno no autenticado
- [ ] Uso de funcionalidades en entorno no autenticado y sin capcha
- [ ] Deficiencias en otros metodos de autenticación (movil, tarjeta de coordenadas etc)
- [ ] Vulnerabilidades en el CAPTCHA

### How to

1. Entender como funciona el mecanismo de autenticación
2. Revisar la calidad del password y credenciales por defecto
3. Enumeración de usuarios
4. Test de bloqueo de cuentas
5. Revisar la funcionalidad de recuperacion de cuentas
6. Revisar la funcionalidad de cambio de password
7. Revisar funciones de impersonalización
8. Revisar "Remember me"
9. Revisar la funcionalidad de autoregistro
10. Revisar predictibilidad de las credenciales autogeneradas
11. Revisar transmision insegura de las credenciales
12. Revisar distribución insegura de las credenciales
13. Revisar almacenamiento inseguro de las credenciales
14. Comprobar que información revela el login en caso de fallo
15. Comprobar el uso de Campchas en entorno no autenticado
16. Comprobar cache de las paginas web

## Fase 5: Gestión de la sesión

### Vulnerabilidades

- [ ] Criptografia insegura de los tokens. Tokens predictivos
- [ ] Transmision de Tokens por get
- [ ] Session fixation
- [ ] Debilidades en el logout
- [ ] CSRF
- [ ] Atributo Cookie is secure
- [ ] Atributo Cookie accesible solo por el protocolo HTTP
- [ ] Cookie scope
- [ ] Cookie persistente
- [ ] Duración de la sesion (Timeout)
- [ ] Vigencia de los tokens
- [ ] Reutilización de los tokens/cookies
- [ ] Los tokens no se comprueban
- [ ] Los tokens no estan ligados al identificador de la sesion
- [ ] Concurrents logins
- [ ] Session hijacking
- [ ] Presencia de la funcionalidad de logout
- [ ] Forzar el uso de cookies por GET

### How to

1. Analizar los tokens
2. Comprobar que los tokens se estan utilizando en la aplicación
3. Comprobar que los tokens son de un solo uso
4. Comprobar que los tokens van unidos al identificador de sesion
5. Comprobar la vigencia de tiempo de los tokens
6. Analizar la transmision de los tokens
7. Revisar el logout de una aplicacion
8. Revisar la creación de sesiones mediante el login
9. Revisar CSRF
10. Revisar cookies
11. Revisar la duracion de la sesion
12. Revisar session hicjacking
13. Revisar concurrent logins 
14. Remove csrf token request
15. Remove csrf token parameter value
16. Remove csrf valor
17. Usar un segundo parametro csrf identico
18. Cambiar post por get con el token

## Fase 6: Autorización

### Vulnerabilidades

- [ ] Escalada vertical de credenciales
- [ ] Escalada horizontal de credenciales
- [ ] Acceso a un recurso mediante la URL (seguridad por ofuscación)
- [ ] Fallo de autorización
- [ ] Deficiencias logica de negocio

### How to

1. Entender los requerimientos
2. Análisis de la funcionalidad: Cómo esta implementada, cómo tendría que funcionar
3. Revisión con multiples cuentas
4. Revisión con cuenta limitada
5. Comparar funcionalidades
6. Comparar peticiones
7. Detectar que parametros conceden el privilegio, eliminar parametros superfluos
8. Comparar parámetros de la misma petición, diferentes usuarios
9. Acceder directamente a los metodos api
10. Revisar la cabecera referer
11. Intercambiar los métodos get/post 
12. Fuzzear los parametros numéricos
13. Determinar encriptación
14. Forzar accesos
15. Cómo se identifica al usuario
16. Analizar limites de los parámetros
17. Defensas de cliente

## Fase 7: Inyección de código

### Vulnerabilidades

- [ ] Inyección de comands
- [ ] SQLi
- [ ] XSS
- [ ] HTTP Spliting
- [ ] URL Redirect
- [ ] Command injection
- [ ] LFI/RFI
- [ ] Path traversal
- [ ] XXE 
- [ ] File Upload

## Fase 8: Varios

### Vulnerabilidades

- [ ] Pading oracle
- [ ] Uso de proxy
- [ ] Criptografia
- [ ] Virtual Host

## Bitácora

### Deducciones/Comentarios

1. pass
2. pass
3. pass

### Pruebas realizas

1. pass
2. pass
3. pass

### Pruebas pendientes

1. pass
2. pass
3. pass

### Listado de vulnerabilidades encontradas

1. pass

2. pass

3. pass

   

